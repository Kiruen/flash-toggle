# 窗口历史记录功能改进 SOP

## 1. 功能概述

本次改进主要针对窗口历史记录功能，包括以下几个方面：
1. 优化历史记录去重逻辑
2. 添加历史记录可视化界面
3. 改进窗口跳转机制

## 2. 代码改进

### 2.1 历史记录去重
- 在 `record_window_activation` 方法中添加去重逻辑
- 如果窗口已存在于历史记录中，先移除旧记录
- 将新记录添加到历史记录末尾
- 更新当前索引位置

### 2.2 历史记录可视化
- 创建新的 `HistoryPage` 类用于展示历史记录
- 使用表格形式展示窗口历史堆栈
- 显示窗口标题、状态和当前位置
- 实时更新历史记录显示（每秒更新）
- 高亮显示当前位置

### 2.3 窗口跳转机制
- 重构窗口跳转逻辑，提取公共代码到 `_jump_to_window` 方法
- 优化窗口激活流程，确保窗口正确显示和置顶
- 改进无效窗口处理，自动从历史记录中移除
- 在跳转后自动记录新激活的窗口

## 3. 使用说明

### 3.1 历史记录页面
1. 在主窗口中切换到"历史记录"标签页
2. 查看最近激活的窗口列表
3. 观察当前位置指示器（蓝色背景和箭头标记）
4. 窗口状态实时更新，包括：
   - 正常
   - 最小化
   - 已隐藏
   - 已失效

### 3.2 窗口跳转
1. 使用全局快捷键在历史记录中导航：
   - `Ctrl+Alt+←`: 跳转到前一个窗口
   - `Ctrl+Alt+→`: 跳转到后一个窗口
2. 跳转时自动处理特殊情况：
   - 恢复最小化的窗口
   - 跳过无效的窗口
   - 循环遍历历史记录

## 4. 注意事项

1. 历史记录去重
   - 同一个窗口多次激活只保留最新的记录
   - 去重基于窗口句柄进行判断
   - 保持历史记录的时间顺序

2. 窗口状态检查
   - 定期检查窗口有效性
   - 自动清理无效的窗口记录
   - 实时更新窗口状态显示

3. 性能优化
   - 使用定时器控制更新频率
   - 避免频繁的窗口状态查询
   - 优化历史记录存储结构

## 5. 调试信息

- 查看日志输出了解历史记录变化
- 观察窗口跳转过程中的状态变化
- 监控无效窗口的处理情况

## 6. 后续优化方向

1. 添加更多历史记录统计信息
2. 支持手动编辑历史记录
3. 提供更多的窗口操作选项
4. 优化历史记录的持久化存储 